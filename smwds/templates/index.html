{% extends "menu.html" %}
{% set active_page = "index" %}
{% block content %}

        <div class="wrapper wrapper-content animated fadeIn">
                   
                <div class="row ">
                    <div class="col-lg-6">
                        <div class="widget white-bg p-lg ">
                            <div class="small pull-left col-md-3 m-l-lg m-t-xs">
                                <strong>System Toplogy</strong> 
                            </div>
                            <div class="small pull-right col-md-3 m-t-xs text-right">
                                <strong>Chart supported by cytoscape.js</strong>
                            </div>
                            <div id="canvas" class="m_status flot-chart-content" style="visibility:visible;">
                                <div id="cy" class="flot-chart-content" >
                                </div></div>
                            <div class="m-loading sk-spinner sk-spinner-wandering-cubes" style="top:-100px;z-index:1000;">
                             <div class="sk-cube1"></div>
                             <div class="sk-cube2"></div>
                             </div>
                        </div>
                    </div>

                    <div class="col-lg-6 text-center  p-xxs">
                        
                        <!--<div class="row m-t-lg">-->
                       <div class="widget gray-bg ">
                              <small>
                                Nodes Managed
                            </small>
                             <h1 id="node" class="sitestatus m-b-xs" style="visibility:visible;"></h1>
                            <div class="site-loading sk-spinner sk-spinner-wave">
                                    <div class="sk-rect1"></div>
                                    <div class="sk-rect2"></div>
                                    <div class="sk-rect3"></div>
                                    <div class="sk-rect4"></div>
                                    <div class="sk-rect5"></div>
                                </div>
                            <div id="sparkline2" class="m-b-sm"></div>
                                   <div class="row">
                                       <div class="col-xs-4">
                                           <small class="stats-label">System Capacity</small>
                                           <h4 id="sc" class="sitestatus" style="visibility:visible;"></h4>
                                            <!-- <div class="site-loading sk-spinner sk-spinner-rotating-plane"></div>-->
                                            <div class="site-loading  sk-spinner sk-spinner-double-bounce">
                                                <div class="sk-double-bounce1"></div>
                                                <div class="sk-double-bounce2"></div>
                                            </div>
                                       </div>

                                       <div class="col-xs-4">
                                           <small class="stats-label">System Utilization</small>
                                           <h4 id="su" class="sitestatus"  style="visibility:visible;"></h4>
                                                <div class="site-loading  sk-spinner sk-spinner-double-bounce">
                                                <div class="sk-double-bounce1"></div>
                                                <div class="sk-double-bounce2"></div>
                                            </div>
                                       </div>
                                       <div class="col-xs-4">
                                           <small class="stats-label">Users</small>
                                           <h4 id="user" class="sitestatus"  style="visibility:visible;"></h4>
                                             <div class="site-loading  sk-spinner sk-spinner-double-bounce">
                                                <div class="sk-double-bounce1"></div>
                                                <div class="sk-double-bounce2"></div>
                                            </div>
                                       </div>
                                   </div>
                            </div>

                        <div class="widget gray-bg ">
                            <small>
                                Master Managed
                            </small>
                            <h1 id="mm" class="sitestatus m-b-xs" style="visibility:visible;"></h1>
                            <!--<div class="site-loading sk-spinner sk-spinner-rotating-plane"></div>-->
                            <div class="site-loading sk-spinner sk-spinner-wave">
                                    <div class="sk-rect1"></div>
                                    <div class="sk-rect2"></div>
                                    <div class="sk-rect3"></div>
                                    <div class="sk-rect4"></div>
                                    <div class="sk-rect5"></div>
                                </div>
                            <div id="sparkline1" class="m-b-sm"></div>
                            <div class="row">
                                <div class="col-xs-4">
                                    <small class="stats-label">Task Queue</small>
                                    <h4 id="task" class="sitestatus"  style="visibility:visible;"></h4>
                                         <div class="site-loading  sk-spinner sk-spinner-double-bounce">
                                                <div class="sk-double-bounce1"></div>
                                                <div class="sk-double-bounce2"></div>
                                            </div>
                                </div>

                                <div class="col-xs-4">
                                    <small class="stats-label">Service Level</small>
                                    <h4 id="sl" class="sitestatus"  style="visibility:visible;"></h4>
                                     <div class="site-loading  sk-spinner sk-spinner-double-bounce">
                                                <div class="sk-double-bounce1"></div>
                                                <div class="sk-double-bounce2"></div>
                                            </div>
                                </div>
                                <div class="col-xs-4">
                                    <small class="stats-label">System Uptime</small>
                                    <h4 id="up" class="sitestatus"  style="visibility:visible;"></h4>
                                        <div class="site-loading  sk-spinner sk-spinner-double-bounce">
                                                <div class="sk-double-bounce1"></div>
                                                <div class="sk-double-bounce2"></div>
                                            </div>
                                </div>
                            </div>
                        

                        </div>

                            
                    </div>



                </div>
           
                <div class="row">
                    <div class="col-lg-8">
                        <div class="ibox float-e-margins">
                            <div class="ibox-content">
                                <div>
                                        <span class="pull-right text-right">
                                        <small>Average Performance for current <strong>selected node</strong></small>
                                            <br/>
                                        </span>
                                    <h3 class="font-bold no-margins">
                                        24 Hour CPU/MEM Utilization 
                                    </h3>
                                    <small>Monitor framework supported by Sensu</small>
                                </div>

                                <div class="m-t-sm">

                                    <div class="row">
                                        
                                        <div class="m_status lot-chart-content" style="visibility:visible;">
                                            <div>
                                            <canvas id="lineChart" height="114"></canvas>
                                            </div>
                                        </div>
                                         <div class="m-loading sk-spinner sk-spinner-wandering-cubes " style="top:-50px;">
                                          <div class="sk-cube1"></div>
                                          <div class="sk-cube2"></div>
                                          </div>
                                        
                                    </div>

                                </div>

                                <div class="m-t-md">
                                    <small id="monitor_date" class="pull-right">
                                        <i class="fa fa-clock-o"> </i>
                                        Last Update: 16.07.2015
                                    </small>
                                    <small>
                                        <strong id="master">Master Name</strong>
                                    </small>
                                </div>

                            </div>
                        </div>
                    </div>
                    <div class="col-lg-4">
                        <div class="ibox float-e-margins">
                            <div class="ibox-title">
                                <!--<span class="label label-warning pull-right">New Warning</span>-->
                                <h5>System activity</h5>
                            </div>
                            
                            
                            <div class="ibox-content" id="hacker-list">
                               <!-- <ul class="sortable-list connectList agile-list ui-sortable" id="todo">-->
                               <ul class="list agile-list connectList ">
                               <!--<li class="warning-element" id="task1">
                                    Simply dummy text of the printing and typesetting industry.
                                    <div class="agile-detail">
                                        <a href="agile_board.html#" class="pull-right btn btn-xs btn-white">Tag</a>
                                        <i class="fa fa-clock-o"></i> 12.10.2015
                                    </div>
                                </li>
                                <li class="success-element" id="task2">
                                    Many desktop publishing packages and web page editors now use Lorem Ipsum as their default.
                                    <div class="agile-detail">
                                        <a href="agile_board.html#" class="pull-right btn btn-xs btn-white">Mark</a>
                                        <i class="fa fa-clock-o"></i> 05.04.2015
                                    </div>
                                </li>
                                <li class="info-element" id="task3">
                                    Sometimes by accident, sometimes on purpose (injected humour and the like).
                                    <div class="agile-detail">
                                        <a href="agile_board.html#" class="pull-right btn btn-xs btn-white">Mark</a>
                                        <i class="fa fa-clock-o"></i> 16.11.2015
                                    </div>
                                </li>
                                <li class="info-element" id="task4">
                                    Sometimes by accident, sometimes on purpose (injected humour and the like).
                                    <div class="agile-detail">
                                        <a href="agile_board.html#" class="pull-right btn btn-xs btn-white">Mark</a>
                                        <i class="fa fa-clock-o"></i> 16.11.2015
                                    </div>
                                </li>
                                <li class="info-element" id="task5">
                                    Sometimes by accident, sometimes on purpose (injected humour and the like).
                                    <div class="agile-detail">
                                        <a href="agile_board.html#" class="pull-right btn btn-xs btn-white">Mark</a>
                                        <i class="fa fa-clock-o"></i> 16.11.2015
                                    </div>
                                </li>
                                <li class="info-element" id="task6">
                                    Sometimes by accident, sometimes on purpose (injected humour and the like).
                                    <div class="agile-detail">
                                        <a href="agile_board.html#" class="pull-right btn btn-xs btn-white">Mark</a>
                                        <i class="fa fa-clock-o"></i> 16.11.2015
                                    </div>
                                </li>-->
                            </ul>
                            <ul class="pagination"></ul>
                            </div>
                            
                        </div>
                    </div>

                </div>  
                
                {% include "datatable.html" %}

               
          

        </div>

       
 




    <script>

        $(document).ready(function() {
            
           socket.on('m_status', function(msg) {
               // console.log('m_status:' + msg);
                update_m_status(msg);

            });  

           socket.on('hackerlist',function(msg){
            console.log('hackerList:'+msg);
            update_hacklist(msg);
           });
        function update_hacklist(m){
            msg = JSON.parse(m);
            //console.log(msg);
            switch (msg.type){
                case 'info':
                var nhlvalues = [
                  { id:hlid++,emit_msg: '<i class="fa fa-sitemap"></i> ' + msg.emit_msg, emit_time: '<i class="emit_time fa fa-at"> ' + Date() + '</i>'}
                    ];
                     break;
                case 'warning':
                var nhlvalues = [
                  { id:hlid++,emit_msg: '<i class="fa fa-warning"></i> ' + msg.emit_msg, emit_time: '<i class="emit_time fa fa-at"> ' + Date() + '</i>'}
                    ];
                     break;
                case 'success':
                var nhlvalues = [
                  { id:hlid++,emit_msg: '<i class="fa fa-user"></i> ' + msg.emit_msg, emit_time: '<i class="emit_time fa fa-at"> ' + Date() + '</i>'}
                    ];
                     break;
            }
            //var nhlvalues = [
             //     { id:hlid++,emit_msg: msg.emit_msg, emit_time: '<i class="emit_time fa fa-at"> ' + Date() + '</i>'}
              //      ];
            hackerList.add(nhlvalues);
            hackerList.sort('id', { order: 'desc' });
            var listone = document.getElementById('hacker-list').getElementsByTagName('li')[0];
            switch (msg.type){
                case 'info':
                    listone.className = "animated bounceInUp info-element";
                    setTimeout(function(){
                      listone.className = "animated bounce info-element";
                         },100);
                     break;
                case 'warning':
                     listone.className = "animated bounceInUp warning-element";
                    setTimeout(function(){
                        listone.className = "animated bounce warning-element";
                           },100);
                     break;
                case 'success':
                     listone.className = "animated bounceInUp success-element";
                    setTimeout(function(){
                        listone.className = "animated bounce success-element";
                           },100);
                     break;

            };
        };

        function update_m_status(j){
                //console.log(j);

                data = JSON.parse(j);
                //console.log(data);
                var c_data = data.master;
                var m_name = c_data.name;
                var l_data = c_data.cpu;
                var m_data = c_data.mem;
                var n_data = JSON.parse(data.top);
                showdata('m_status');
                hideloading('m-loading');
                cy.load(n_data);
               // console.log(c_data);
                //console.log(m_name);

                //console.log(l_data);
                //console.log(m_data);
                document.getElementById('master').innerHTML = 'Master Name :' + m_name;
                document.getElementById('monitor_date').innerHTML = 'Last Update:' + Date();
                var lineData = {
                    //labels: ["label 1", "label 2", "label 3", "label 4", "label 5", "label 6", "label 7"],
                labels:  l_data[1],
                  datasets: [
                       {
                           label: "CPU",
                           backgroundColor: "rgba(220,220,220,0.5)",
                           borderColor: "rgba(220,220,220,1)",
                           pointBorderColor: "rgba(220,220,220,1)",
                           pointBackgroundColor:"#fff",
                           pointHoverBackgroundColor:  "#fff",
                           pointHoverBorderColor:"rgba(220,220,220,1)",
                           /*
                           fillColor: "rgba(220,220,220,0.5)",
                           strokeColor: "rgba(220,220,220,1)",
                           pointColor: "rgba(220,220,220,1)",
                           pointStrokeColor: "#fff",
                           pointHighlightFill: "#fff",
                           pointHighlightStroke: "rgba(220,220,220,1)",
                           */
                           data: l_data[0]
                       },
                       {
                           label: "MEM",
                           backgroundColor: "rgba(26,179,148,0.5)",
                           borderColor: "rgba(26,179,148,0.7)",
                           pointBorderColor: "rgba(26,179,148,1)",
                           pointBackgroundColor:"#fff",
                           pointHoverBackgroundColor:  "#fff",
                           pointHoverBorderColor:"rgba(26,179,148,1)",
                           /*fillColor: "rgba(26,179,148,0.5)",
                           strokeColor: "rgba(26,179,148,0.7)",
                           pointColor: "rgba(26,179,148,1)",
                           pointStrokeColor: "#fff",
                           pointHighlightFill: "#fff",
                           pointHighlightStroke: "rgba(26,179,148,1)",*/
                           data: m_data[0]
                       }
                   ]
               };

               var lineOptions = {
                   showLine: true,
                   scaleShowGridLines: true,
                   scaleGridLineColor: "rgba(0,0,0,.05)",
                   scaleGridLineWidth: 1,
                   bezierCurve: true,
                   bezierCurveTension: 0.4,
                   pointDot: true,
                   pointDotRadius: 4,
                   pointDotStrokeWidth: 1,
                   pointHitDetectionRadius: 20,
                   datasetStroke: true,
                   datasetStrokeWidth: 2,
                   datasetFill: true,
                   responsive: true,
               };


               var ctx = document.getElementById("lineChart").getContext("2d");
               ///var myNewChart = new Chart(ctx).Line(lineData, lineOptions);
               var myLineChart = new Chart(ctx, {
                        type: 'line',
                        data: lineData,
                        options: lineOptions
                    });




            };

           var cy =  cytoscape({                        
                           container: document.getElementById('cy'),
                        
                        //   elements: json,
                        
                           boxSelectionEnabled: false,
                           autounselectify: true,

                           layout: {
                               name: 'random'
                           },
                           minZoom: 0.3,
                           maxZoom: 3,
                           wheelSensitivity: 0.8,
                           style: [
                               {
                                   selector: 'node',
                                   style: {
                                       'content': 'data(id)',
                                       'text-opacity': 0.5,
                                       'text-valign': 'center',
                                       'text-halign': 'right',
                                       'background-color': '#11479e'
                                   }
                               },

                               {
                                   selector: 'edge',
                                   style: {
                                       'width': 4,
                                       'target-arrow-shape': 'triangle',
                                       'line-color': '#9dbaea',
                                       'target-arrow-color': '#9dbaea',
                                       'curve-style': 'bezier'
                                   }
                               }
                           ]
                        
                        });
                var hlid = 0;
                var hloptions = {
                  valueNames: [ 'emit_msg', 'emit_time',{ data: ['id'] } ],
                 // item: '<li class="warning-element animated fadeInUp" ><p class="emit_msg"></p><div  class="agile-detail emit_time"></div></li>'
                 item: '<li data-id="1" class=" animated bounceInUp " ><p class="emit_msg"></p><div  class="agile-detail emit_time"></div></li>',
                 page:6,
                 plugins: [
                       ListPagination({})
                     ]
                };
                
                //warning-element info-element success-element
                var hlvalues = [
                  { id:hlid++,emit_msg: 'System initialization completed', emit_time: '<i class="fa fa-warning"> ' + Date() + '</i>'}
                ];
                
                var hackerList = new List('hacker-list', hloptions); 
                hackerList.on('sortComplete',function(){
                  //  console.log('sort completed.');
                });
               $('#hacker-list').click(function() {
                hackerList.add([{ id:hlid++,emit_msg: '<i class="fa fa-warning"></i> System initialization completed', emit_time: '<i class="fa fa-warning"> ' + Date() + '</i>'}]);  
                hackerList.sort('id', { order: 'desc' });
               ///console.log(hackerList.search());
               //console.log(document.getElementById('hacker-list').getElementsByTagName('li')[0]);
              // console.log(hlid);
                document.getElementById('hacker-list').getElementsByTagName('li')[0].className = "animated bounceInUp warning-element";
                setTimeout(function(){
                 document.getElementById('hacker-list').getElementsByTagName('li')[0].className = "animated bounce warning-element";
                }
                    , 100);

                });
                   
                ///fa-warning fa-wrench fa-user fa-sitemap
/*
            var d1 = [[1262304000000, 6], [1264982400000, 3057], [1267401600000, 20434], [1270080000000, 31982], [1272672000000, 26602], [1275350400000, 27826], [1277942400000, 24302], [1280620800000, 24237], [1283299200000, 21004], [1285891200000, 12144], [1288569600000, 10577], [1291161600000, 10295]];
            var d2 = [[1262304000000, 5], [1264982400000, 200], [1267401600000, 1605], [1270080000000, 6129], [1272672000000, 11643], [1275350400000, 19055], [1277942400000, 30062], [1280620800000, 39197], [1283299200000, 37000], [1285891200000, 27000], [1288569600000, 21000], [1291161600000, 17000]];
*/

/*
            var data1 = [
                [0,4],[1,8],[2,5],[3,10],[4,4],[5,16],[6,5],[7,11],[8,6],[9,11],[10,20],[11,10],[12,13],[13,4],[14,7],[15,8],[16,12]
            ];
            var data2 = [
                [0,0],[1,2],[2,7],[3,4],[4,11],[5,4],[6,2],[7,5],[8,11],[9,5],[10,4],[11,1],[12,5],[13,2],[14,5],[15,2],[16,0]
            ];

            $("#flot-dashboard5-chart").length && $.plot($("#flot-dashboard5-chart"), [
                        data1,  data2
                    ],
                    {
                        series: {
                            lines: {
                                show: false,
                                fill: true
                            },
                            splines: {
                                show: true,
                                tension: 0.4,
                                lineWidth: 1,
                                fill: 0.4
                            },
                            points: {
                                radius: 0,
                                show: true
                            },
                            shadowSize: 2
                        },
                        grid: {
                            hoverable: true,
                            clickable: true,

                            borderWidth: 2,
                            color: 'transparent'
                        },
                        colors: ["#1ab394", "#1C84C6"],
                        xaxis:{
                        },
                        yaxis: {
                        },
                        tooltip: false
                    }
            );*/
/*
            var l_data = "" 
            var m_data = ""
            var lineData = {
                //labels: ["label 1", "label 2", "label 3", "label 4", "label 5", "label 6", "label 7"],
                labels:  l_data[1],
                datasets: [
                    {
                        label: "Example dataset",
                        fillColor: "rgba(220,220,220,0.5)",
                        strokeColor: "rgba(220,220,220,1)",
                        pointColor: "rgba(220,220,220,1)",
                        pointStrokeColor: "#fff",
                        pointHighlightFill: "#fff",
                        pointHighlightStroke: "rgba(220,220,220,1)",
                        data: l_data[0]
                    },
                    {
                        label: "Example dataset",
                        fillColor: "rgba(26,179,148,0.5)",
                        strokeColor: "rgba(26,179,148,0.7)",
                        pointColor: "rgba(26,179,148,1)",
                        pointStrokeColor: "#fff",
                        pointHighlightFill: "#fff",
                        pointHighlightStroke: "rgba(26,179,148,1)",
                        data: m_data[0]
                    }
                ]
            };

            var lineOptions = {
                scaleShowGridLines: true,
                scaleGridLineColor: "rgba(0,0,0,.05)",
                scaleGridLineWidth: 1,
                bezierCurve: true,
                bezierCurveTension: 0.4,
                pointDot: true,
                pointDotRadius: 4,
                pointDotStrokeWidth: 1,
                pointHitDetectionRadius: 20,
                datasetStroke: true,
                datasetStrokeWidth: 2,
                datasetFill: true,
                responsive: true,
            };


            var ctx = document.getElementById("lineChart").getContext("2d");
            var myNewChart = new Chart(ctx).Line(lineData, lineOptions);
*/

            $('.footable').footable();
    
            $('.footable').footable().bind({
                  'footable_filtering' : function(e) {
                        
                        $('#animation_table').removeAttr('class').attr('class', '');
                        //$('#animation_table').addClass('animated');
                        //$('#animation_table').addClass('shake');
                        return ;
                  },

                  'footable_filtered' : function(e) {
                        
                        
                        $('#animation_table').removeAttr('class').attr('class', '');
                        $('#animation_table').addClass('animated');
                        $('#animation_table').addClass('flipInX');
                        
                        return;              
                  },
            });

            $('#search_btn1').click(function (e) {
                                e.preventDefault();
                            
                                //get the footable filter object
                                var footableFilter = $('.footable').data('footable-filter');
                            
                                
                                //filter by 'tech'
                                var search_text = $('#search1').val();
                                
                                footableFilter.filter(search_text);
                            
                            });


            /*$('.footable2').footable();

            $('.footable2').footable().bind({
                  'footable_filtering' : function(e) {
                        
                        $('#animation_table2').removeAttr('class').attr('class', '');
                        //$('#animation_table').addClass('animated');
                        //$('#animation_table').addClass('shake');
                        return ;
                  },

                  'footable_filtered' : function(e) {
                        
                        $('#animation_table2').removeAttr('class').attr('class', '');
                        $('#animation_table2').addClass('animated');
                        $('#animation_table2').addClass('flipInY');
                        
                        return;              
                  },
            });

             $('#search_btn2').click(function (e) {
                                e.preventDefault();
                            
                                //get the footable filter object
                                var footableFilter = $('.footable2').data('footable-filter');
                            
                                
                                //filter by 'tech'
                                var search_text = $('#search2').val();
                                
                                footableFilter.filter(search_text);
                            
                            });*/

        });
        

           
    </script>
    {% endblock %}