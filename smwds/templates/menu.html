<!DOCTYPE html>
<html>

<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Deyun.io</title>

    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="font-awesome/css/font-awesome.css" rel="stylesheet">
    <!--<link href="css/animate.css" rel="stylesheet">-->
    <link href="css/animate-2.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">
    <!--<link href="css/plugins/dataTables/datatables.min.css" rel="stylesheet">-->
    <!-- FooTable -->
    <link href="css/plugins/footable/footable.core.css" rel="stylesheet">
    <!--<link href="js/plugins/footable-standalone.latest/css/footable.standalone.css" rel="stylesheet">-->
    <!--<link href="css/plugins/toastr/toastr.min.css" rel="stylesheet">-->


</head>

<body class="top-navigation">

    <div id="wrapper">
        <div id="page-wrapper" class="gray-bg">
        <div class="row border-bottom white-bg">
        <nav class="navbar navbar-fixed-top" role="navigation">
            <div class="navbar-header">
                {% cache 60*5 %}
                <button aria-controls="navbar" aria-expanded="false" data-target="#navbar" data-toggle="collapse" class="navbar-toggle collapsed" type="button">
                    <i class="fa fa-reorder"></i>
                </button>
                <a href="dashboard_4.html#" class="navbar-brand">Deyun.io</a>
            </div>
            {% set active_page = active_page|default('index') %}
            <div class="navbar-collapse collapse" id="navbar">
                <ul class="nav navbar-nav">
                    <li class="active">
                        <a aria-expanded="false" role="button" href="index.html"> Main </a>
                    </li>
                    <li class="dropdown">
                        <a aria-expanded="false" role="button" href="index.html#" class="dropdown-toggle" data-toggle="dropdown"> Asset Manager <span class="caret"></span></a>
                        <ul role="menu" class="dropdown-menu">
                            <li><a href="{{ url_for('frontend.closed') }}" >Toplogy</a></li>
                            <li><a href="{{ url_for('frontend.closed') }}">List</a></li>
                            <li><a href="{{ url_for('frontend.closed') }}">Search</a></li>
                            <li><a href="{{ url_for('frontend.closed') }}">Service</a></li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a aria-expanded="false" role="button" href="index.html#" class="dropdown-toggle" data-toggle="dropdown"> Monitor <span class="caret"></span></a>
                        <ul role="menu" class="dropdown-menu">
                            <li><a href="{{ url_for('frontend.closed') }}">Perf</a></li>
                            <li><a href="{{ url_for('frontend.closed') }}">Event</a></li>
                            <li><a href="{{ url_for('frontend.closed') }}">Log</a></li>
                            <li><a href="{{ url_for('frontend.closed') }}">Http</a></li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a aria-expanded="false" role="button" href="index.html#" class="dropdown-toggle" data-toggle="dropdown"> State <span class="caret"></span></a>
                        <ul role="menu" class="dropdown-menu">
                            <li><a href="{{ url_for('frontend.closed') }}">Apply</a></li>
                            <li><a href="{{ url_for('frontend.closed') }}">History</a></li>
                            <li><a href="{{ url_for('frontend.closed') }}">New</a></li>
                            <li><a href="{{ url_for('frontend.closed') }}">Run CMD</a></li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a aria-expanded="false" role="button" href="index.html#" class="dropdown-toggle" data-toggle="dropdown"> Settings <span class="caret"></span></a>
                        <ul role="menu" class="dropdown-menu">
                            <li><a href="{{ url_for('frontend.closed') }}">Node Register</a></li>
                            <li><a href="{{ url_for('frontend.closed') }}">Master Manager</a></li>
                            <li><a href="{{ url_for('frontend.closed') }}">SSH Auth</a></li>
                            <li><a href="{{ url_for('frontend.closed') }}">User Profile</a></li>
                        </ul>
                    </li>

                </ul>
                <ul class="nav navbar-top-links navbar-right">
                    <li>
                        <a href="{{ url_for('frontend.logout') }}">
                            <i class="fa fa-sign-out"></i> Log out
                        </a>
                    </li>
                </ul>       
                {% endcache %}
                {% include "sidebar.html" %}
            </div>
        </nav>
        </div>


         <!-- Mainly scripts -->
    <script src="js/jquery-2.1.1.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/plugins/metisMenu/jquery.metisMenu.js"></script>
    <script src="js/plugins/slimscroll/jquery.slimscroll.min.js"></script>

    <!-- Custom and plugin javascript -->
    <script src="js/inspinia.js"></script>
    <script src="js/plugins/pace/pace.min.js"></script>

    <!-- Flot -->
    <script src="js/plugins/flot/jquery.flot.js"></script>
    <script src="js/plugins/flot/jquery.flot.tooltip.min.js"></script>
    <script src="js/plugins/flot/jquery.flot.spline.js"></script>
    <script src="js/plugins/flot/jquery.flot.resize.js"></script>
    <script src="js/plugins/flot/jquery.flot.pie.js"></script>
    <script src="js/plugins/flot/jquery.flot.symbol.js"></script>
    <script src="js/plugins/flot/jquery.flot.time.js"></script>

    <!-- ChartJS-->
    <!--<script src="js/plugins/chartJs/Chart.min.js"></script>-->
    <script src="js/plugins/chartJs/Chart.min23.js"></script>
    <!-- Peity -->
    <script src="js/plugins/peity/jquery.peity.min.js"></script>
    <!-- Peity demo -->
    <script src="js/demo/peity-demo.js"></script>

        <!-- Sparkline -->
    <script src="js/plugins/sparkline/jquery.sparkline.min.js"></script>

    <!--<script src="js/plugins/dataTables/datatables.min.js"></script>-->
    <script src="js/plugins/footable/footable.all.min.js"></script>
    <!--<script src="js/plugins/footable-standalone.latest/js/footable.js"></script>-->
    <!--raphael and cloudrelation-->
    <script src="js/plugins/cloudrelation/raphael.js"></script>

    <script src="js/plugins/cloudrelation/cloudRelation.js"></script>

    <script src="js/plugins/cytoscape/cytoscape.js"></script>
    <!--dagra 0.74-->
    <script src="js/dagre.min.js"></script>
    <!--cytoscape-dagre 1.12-->
    <script src="js/cytoscape-dagre.js"></script>
    <!--socketio 1.35-->
    <script type="text/javascript" src="js/socket.io.min.js"></script>

    <script async src="js/data.js" ></script>
    <!--listjs-->
    <script src="js/list.js"></script>
    <script src="js/list.pagination.min.js"></script>
    <!--prettyprint.js-->
    <script src="js/prettyprint.js"></script>
    <!--Notification script-->
    <!--<script src="js/plugins/toastr/toastr.min.js"></script>-->
    <script src="js/bootstrap-notify.min.js"></script>

            
        {% block content %}{% endblock %}
    

    
    <script type="text/javascript" charset="utf-8">
        $(document).ready(function() {
            var mltask = 0;
            var mlexec = 0;
            var mloptions = {
                  valueNames: ['ml_title', 'ml_progress_info','ml_info', 'ml_progress',{ attr: 'data-jid', name: 'jid' }],
                  //<div style="width: 22%;"class="progress-bar progress-bar-warning"></div> <button class="ml_test">Test button></button>
                 item: '<li><a><div class="small  pull-left m-t-xs media-body"><h4 class=" text-center ml_title jid" data-jid="23456"></h4><p class="ml_info"></p></div><div class="small ml_progress_info"></div><div class="progress progress-mini ml_progress"></div></a></li>',
                 page:50
                 /*plugins: [
                       ListPagination({})
                     ]*/
                };
                //warning-element info-element success-element
            //var mlvalues = [{ml-title:'System initialization completed'}, {ml-info: ''}, {ml-progress:''}];
            var mlvalues = [{
                jid:'111222',
                ml_title: 'Jonny Str√∂mberg',
                ml_progress_info: 'ETA : 5 minutes',
                ml_info: '1986+asdasdasdsadasdsa very long descriptyion very long descriptyion very long descriptyion very long descriptyion',
                ml_progress: '<div style="width: 22%;"class="progress-bar progress-bar-warning"></div>'
              },
              {
                jid:'222333',
                ml_title: 'Jonas Arnklint',
                ml_progress_info: 'ETA : 5 minutes',
                ml_info: '1985+asdasdasdasd........................................',
                ml_progress: '<div style="width: 22%;"class="progress-bar progress-bar-warning"></div>'
              }];
            var menuList = new List('menu-list', mloptions); 
            $('.ml_test').click(function() {
            var itemId = $(this).closest('li').find('.jid').attr('data-jid');
            console.log(menuList.get("jid","1"));
            });

            socket.on('salt_task_menu', function(msg) {
                update_menulist(msg);
                //console.log( document.getElementById('menu-list'));
                //socket.emit('my_event', {data: 'I\'m connected!'});
                //console.log('I\'m connected! :' + msg);
            });
            socket.on('sitestatus', function(msg) {
                //console.log('sitestatus:' + msg);
                update_sitestatus(msg);
            });
            socket.on('func_init', function(msg) {
                d = JSON.parse(msg);
               console.log('function : ' + msg + ' initialized ');
               switch (d.func) {
                            case 'sitestatus':
                                cleardata('sitestatus');
                                showloading('site-loading');
                                socket.emit('func_init',msg)
                                break;
                            case 'm_status':
                                hidedata('m_status');
                                showloading('m-loading');
                                socket.emit('func_init',msg);
                                break;
                            case 'nodelist':
                                hidedata('nodelist');
                                showloading('node-loading');
                                socket.emit('func_init',msg);
                                break;
                            case 'salt_task_list':
                                socket.emit('func_init',msg);
                                break;
                            case 4:
                                
                                break;
                            case 5:
                                
                                break;
                            case 6:
                                break;
                            default:
                                 console.log('wrong function name');
                        } 

            });
            socket.on('status', function(msg) {
               // console.log('status:' + msg);
            });


            function update_menulist(m){
            msg = JSON.parse(m);
            console.log(msg);
            var newmlvalues ={
                jid: msg.jid,
                ml_title: msg.jid,
                ml_progress_info: msg.tgt + msg.msg,
                ml_info: msg.info,
                ml_progress: '<div style="width: '+ msg.progress+'%;"class="progress-bar progress-bar-'+msg.type+'"></div>'
              };
            switch (msg.msg){
                case 'started':
                    mltask += 1;
                    mlexec += 1;
                    menuList.add(newmlvalues);
                    break;
                case 'completed':
                    mlexec -= 1;
                    var mlitem = menuList.get('jid', msg.jid)[0];
                    mlitem.values(newmlvalues);
                default:
                    var mlitem = menuList.get('jid', msg.jid)[0];
                    mlitem.values(newmlvalues);
            }
            console.log(menuList.get('jid', msg.jid));
            
            document.getElementById('ml_task_counter').innerHTML = mlexec;
            document.getElementById('task_counter').innerHTML = ' You have '+mltask +' tasks. '+mlexec+' is running';
            };

            
            });
        </script>

        <div class="footer">
            <div class="pull-right">
                10GB of <strong>250GB</strong> Free.
            </div>
            <div>
                <strong>Copyright</strong> Deyun.io &copy; 2014-2015
            </div>
        </div>

        </div>
        </div>


   


   

</body>

</html>
